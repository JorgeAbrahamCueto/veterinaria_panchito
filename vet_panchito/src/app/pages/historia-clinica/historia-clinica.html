<div class="container py-4">
  <h3 class="text-center mb-4">ğŸ“‹ Registro de Historia ClÃ­nica</h3>

  <!-- BotÃ³n volver al panel -->
  <div class="mb-3 text-start">
    <a routerLink="/acceso-veterinario" class="btn btn-outline-secondary">
      â† Volver al panel
    </a>
  </div>

  <!-- Formulario -->
  <form (ngSubmit)="guardarHistoria()" #form="ngForm">
    <h5>ğŸ‘¤ Datos del dueÃ±o</h5>
    <div class="row g-2">
      <div class="col-md-6">
        <input type="text" [(ngModel)]="historia.nombreDueno" name="nombreDueno" class="form-control" placeholder="Nombre completo" required />
      </div>
      <div class="col-md-6">
        <input type="email" [(ngModel)]="historia.correoDueno" name="correoDueno" class="form-control" placeholder="Correo" required />
      </div>
      <div class="col-md-6">
        <input type="text" [(ngModel)]="historia.celularDueno" name="celularDueno" class="form-control" placeholder="Celular" required />
      </div>
      <div class="col-md-6">
        <input type="text" [(ngModel)]="historia.direccionDueno" name="direccionDueno" class="form-control" placeholder="DirecciÃ³n" required />
      </div>
      <div class="col-md-6">
        <select [(ngModel)]="historia.documentoDueno" name="documentoDueno" class="form-select" required>
          <option value="" disabled>Tipo de documento</option>
          <option value="DNI">DNI</option>
          <option value="Carnet de extranjerÃ­a">Carnet de extranjerÃ­a</option>
          <option value="Pasaporte">Pasaporte</option>
        </select>
      </div>
      <div class="col-md-6">
        <input type="text" [(ngModel)]="historia.numeroDocumentoDueno" name="numeroDocumentoDueno" class="form-control" placeholder="NÃºmero de documento" required />
      </div>
    </div>

    <h5 class="mt-4">ğŸ¾ Datos del paciente</h5>
    <div class="row g-2">
      <div class="col-md-6">
        <input type="text" [(ngModel)]="historia.nombrePaciente" name="nombrePaciente" class="form-control" placeholder="Nombre del peludito" required />
      </div>
      <div class="col-md-6">
        <input type="text" [(ngModel)]="historia.especiePaciente" name="especiePaciente" class="form-control" placeholder="Especie" required />
      </div>
      <div class="col-md-6">
        <input type="text" [(ngModel)]="historia.razaPaciente" name="razaPaciente" class="form-control" placeholder="Raza" required />
      </div>
      <div class="col-md-3">
        <input type="text" [(ngModel)]="historia.edadPaciente" name="edadPaciente" class="form-control" placeholder="Edad" required />
      </div>
      <div class="col-md-3">
        <input type="text" [(ngModel)]="historia.pesoPaciente" name="pesoPaciente" class="form-control" placeholder="Peso" required />
      </div>
      <div class="col-md-6">
        <select [(ngModel)]="historia.sexoPaciente" name="sexoPaciente" class="form-select" required>
          <option value="" disabled>Sexo</option>
          <option value="Macho">Macho</option>
          <option value="Hembra">Hembra</option>
        </select>
      </div>
      <div class="col-md-6">
        <input type="text" [(ngModel)]="historia.enfermedadesPaciente" name="enfermedadesPaciente" class="form-control" placeholder="Enfermedades previas" />
      </div>
      <div class="col-12">
        <textarea [(ngModel)]="historia.resenaPaciente" name="resenaPaciente" class="form-control" placeholder="ReseÃ±a clÃ­nica" rows="3"></textarea>
      </div>
    </div>

    <button type="submit" class="btn btn-primary mt-3">
      {{ modoEdicion ? 'Actualizar historia' : 'Registrar historia' }}
    </button>
  </form>

  <hr class="my-4" />

  <!-- BÃºsqueda -->
  <div class="row mb-3">
    <div class="col-md-4">
      <input
        type="text"
        [(ngModel)]="busquedaNombre"
        (input)="buscarPorNombrePaciente()"
        placeholder="ğŸ” Buscar por nombre del paciente"
        class="form-control"
      />
    </div>
    <div class="col-md-4">
      <input
        type="text"
        [(ngModel)]="busquedaDNI"
        (input)="buscarPorDni()"
        placeholder="ğŸ” Buscar por DNI del dueÃ±o"
        class="form-control"
      />
    </div>
    <div class="col-md-4">
      <input
        type="text"
        [(ngModel)]="busquedaCodigo"
        (input)="buscarPorCodigo()"
        placeholder="ğŸ” Buscar por cÃ³digo (ID)"
        class="form-control"
      />
    </div>
  </div>

  <!-- Tabla -->
  <h5 class="text-center">ğŸ“ Historias registradas</h5>
  <table class="table table-bordered table-hover mt-3" *ngIf="historiasGuardadas.length > 0">
    <thead class="table-light">
      <tr>
        <th style="width: 80px;">ID</th>
        <th>DueÃ±o</th>
        <th>Paciente</th>
        <th style="width: 220px;">Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let h of historiasGuardadas; let i = index">
        <td>{{ h.id }}</td>
        <td>
          <div><strong>{{ h.nombreDueno }}</strong></div>
          <div>{{ h.correoDueno }}</div>
          <div>{{ h.documentoDueno }}: {{ h.numeroDocumentoDueno }}</div>
          <div>ğŸ“ {{ h.celularDueno }}</div>
          <div>ğŸ“ {{ h.direccionDueno }}</div>
        </td>
        <td>
          <div><strong>{{ h.nombrePaciente }}</strong></div>
          <div>{{ h.especiePaciente }} â€” {{ h.razaPaciente }}</div>
          <div>Edad: {{ h.edadPaciente }} | Peso: {{ h.pesoPaciente }}</div>
          <div>Sexo: {{ h.sexoPaciente }}</div>
          <div class="text-muted">Enfermedades: {{ h.enfermedadesPaciente || 'Ninguna' }}</div>
        </td>
        <td>
          <button class="btn btn-sm btn-outline-primary me-1" (click)="editarHistoria(i)">âœï¸ Editar</button>
          <button class="btn btn-sm btn-outline-danger me-1" (click)="eliminarHistoria(h.id!)">ğŸ—‘ï¸ Eliminar</button>
          <button class="btn btn-sm btn-outline-secondary" (click)="imprimir(h)">ğŸ–¨ï¸ Imprimir</button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Estado vacÃ­o -->
  <div *ngIf="historiasGuardadas.length === 0" class="text-center text-muted py-3">
    No se encontraron historias clÃ­nicas. Registra una nueva o ajusta los filtros.
  </div>
</div>